{#<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">  drop_down didnt works with this line#}
{#<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script> drop_down didnt works with this line#}
{#<meta name="viewport" content="width=device-width, initial-scale=1">#}
{#<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">#}
{#<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>#}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
{#<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">#}
{#<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>#}
{#<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>#}
{#<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>#}
{#<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">#}
{#<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>#}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
<script src="https://malsup.github.io/jquery.form.js"></script>


<div class="container-fluid">
    <div class="card-columns">
        {% for category in data %}
            {% if data[category] is mapping %}
                <h1 class="bg-secondary p-4">{{ category }}</h1>
                {% for child_category in data[category] %}
                    <h1 class="bg-info p-3">{{ child_category }}</h1>
                    {% for item in data[category][child_category] %}
                        <div class="card bg-light">
                            <div class="card-body">
                                <img src="{{ item.image_url }}" alt="tea" class="w-100 card-img-top"
                                     style="line-height: 5vh">
                                <h3 class="card-text fw-light mt-3">{{ item.name }}</h3>
                                <button type="button" class="btn btn-secondary mt-4 w-100" data-bs-toggle="modal"
                                        data-bs-target="#myModal" onclick="func(this.id)"
                                        id="{{ item.id }} {{ item.name }}">
                                    {#                                <button class="btn btn-secondary mt-4 w-100" data-toggle="modal" data-target="#modal">#}
                                    Add To Cart
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                {% endfor %}
            {% else %}
                <h1 class="bg-secondary p-4">{{ category }}</h1>
                {% for item in data[category] %}
                    <div class="card bg-light">
                        <div class="card-body">
                            <img src="{{ item.image_url }}" alt="tea" class="w-100 card-img-top"
                                 style="line-height: 5vh">
                            <h3 class="card-text fw-light mt-3">{{ item.name }}</h3>
                            <button type="button" class="btn btn-secondary mt-4 w-100" data-bs-toggle="modal"
                                    data-bs-target="#myModal" onclick="func(this.id)"
                                    id="{{ item.id }} {{ item.name }}">
                                {#                                <button class="btn btn-secondary mt-4 w-100" data-toggle="modal" data-target="#modal">#}
                                Add To Cart
                            </button>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endfor %}
    </div>
</div>


<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Adding items to cart</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <form action="http://127.0.0.1:5000/order/1" method="POST" id="idForm" class="was-validated">
                    <div class="dropdown" id="available-tables">
                        {% if tables %}
                            <button type="button" class="btn btn-warning dropdown-toggle" data-bs-toggle="dropdown">
                                Select Your Table
                            </button>
                            <ul class="dropdown-menu">
                                {% for i in tables %}
                                    <li><a class="dropdown-item" href="#" onclick="tableIdSet(this.id)"
                                           id={{ i.id }}>Table {{ i.id }} Space: {{ i.space }}</a></li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <lable class="form-label">Count:</lable>
                    <input type="number" class="form-control" name="number_id" id="count" required
                           oninput="absNumber(this.value)">
                    <div class="invalid-feedback">
                        please fill Count!
                    </div>
                    <label class="form-label" for="item_type">Item: </label><input style="border: 0;background: white"
                                                                                   class="form-control" type="text"
                                                                                   name="item_type"
                                                                                   id="item_type" disabled>
                    <input type="number" class="d-none" id="item_id" name="item_id" required>
                    <label class="form-label" for="table_id">Table: </label><input style="border: 0;background: white"
                                                                                   class="form-control" type="text"
                                                                                   name="table_id"
                                                                                   id="table_id" disabled>
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <input type="button" class="btn btn-success" value="Add to card" onclick="order()">
                    </div>
                </form>
                <div id="msg" class="flash fade-in"></div>
            </div>


        </div>
    </div>
</div>


<script>
    function func(ItemValue) {
        let elem = ItemValue.slice(" ")
        $(`#item_id`).val(elem[0])
        $(`#item_type`).val(elem)
        $(`#count`).val(1)

    }

    function DisableTableSet(value) {
        $(`#table_id`).val(value)
        $(`#available-tables`).empty()
    }
    {% if table_id %}
        DisableTableSet({{ table_id }})
    {% endif %}
    function tableIdSet(TableIdValue) {
        let elem = $(`#${TableIdValue}`).attr('id')
        $(`#table_id`).val(elem)

    }

    function absNumber(number) {

        if (number <= 0) {
            if (number < 0) {
                $("#count").val(number * -1)
            } else {
                $("#count").val(1)
            }
        }

    }

    {##}
    {#$("#idForm").ajaxForm({#}
    {#    url: 'http://127.0.0.1:5000/order/1', type: 'post', success: function (data, response) {#}
    {#        alert(data); // show response from the php script.#}
    {#        alert(response); // show response from the php script.#}
    {#    }#}

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function demo(x) {
        {#console.log('Taking a break...');#}

        await sleep(x);
        {#console.log('finished');#}

        $('#msg').empty();


    }


    function order() {
        let elem = $(`#count`)
        let count = elem.val()
        let tbl = $(`#table_id`)
        let t_id = tbl.val()
        let item_id = $(`#item_id`)
        let i_id = item_id.val()
        {#console.log(table_id)#}
        {#console.log(t_id)#}
        {#        {% set x = '99' %}#}
        {#        console.log({{ url_for('order') }})#}
        {#        console.log(typeof t_id)#}
        $.ajax({
            type: "POST",
            url: `http://127.0.0.1:5000/order/${t_id}`,
            {#url: "{{ url_for('order',table_id=t_id) }}",  #}
            data: {
                'number_item': count,
                {#'table_id': t_id,#}
                "item_id": i_id,

            },
            success: function (response) {
                let parrent = $("#msg")
                let msg = $(` <div class="alert alert-success alert-dismissible fade show">
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        <strong>Success!</strong> ${response}
                    </div>`)
                {#$(".flash").fadeTo(500, 0).slideUp(500, function () {#}
                msg.appendTo(parrent)
                demo(3000)
                //});

                DisableTableSet(t_id)
                window.setTimeout(function () {
                    $(".flash").fadeTo(500, 0).slideUp(500, function () {
                        $(this).remove();
                    });
                }, 3000);
                {#alert(response); // show response from the php script.#}
                {#alert(data); // show response from the php script.#}
            },
            error: function (response) {
                let parrent = $("#msg")
                let msg = $(` <div class="alert alert-danger alert-dismissible fade show">
                                <strong>Error while adding order!</strong>
                              </div>`)
                msg.appendTo(parrent)

            }
        })
    }

    {#<button type="button" class="btn-close" data-bs-dismiss="alert" onclick=$(".alert").fadeOut("slow")></button>#}

    {##}
    {#$("#idForm").ajaxForm({url: 'http://127.0.0.1:5000/order/1', type: 'post', success: function (data,response) {#}
    {#            alert(data); // show response from the php script.#}
    {#            alert(response); // show response from the php script.#}
    {#        }})#}
    {#$("#idForm").ajaxForm({url: 'http://127.0.0.1:5000/order/1', type: 'post', success: function (data,response) {#}
    {#            alert(data); // show response from the php script.#}
    {#            alert(response); // show response from the php script.#}
    {#        }})#}


    {#function order() {#}
    {#    let form = $('#idForm')#}
    {#    $.ajax({#}
    {#        type: "POST",#}
    {#        url: "http://127.0.0.1:5000/order/1",#}
    {#        data: form.serialize(),#}
    {#        success: function (response) {#}
    {#            alert(response); // show response from the php script.#}
    {#        }#}
    {#    })#}


    {#function order() {#}
    {#    alert("ok")#}
    {#    let form = $('#idForm')#}
    {#    $.ajax({#}
    {#        type: "POST",#}
    {#        url: form.attr("action"),#}
    {#        data: form.serialize(),#}
    {#        success: function (data, response) {#}
    {#            alert(data); // show response from the php script.#}
    {#            alert(response); // show response from the php script.#}
    {#        }#}
    {#    })#}
    {#function order(){#}
    {#    let form = $('#idForm')#}
    {#    $.ajax({#}
    {#        type: "POST",#}
    {#        url:form.attr("action"),#}
    {#        data:form.serialize(),#}
    {#        success: function (data,response) {#}
    {#            alert(data); // show response from the php script.#}
    {#            alert(response); // show response from the php script.#}
    {#        }#}
    {#    })#}


    {#$("#idForm").submit(function (e) {#}
    {#    e.preventDefault(); // avoid to execute the actual submit of the form.#}
    {#    var form = $(this);#}
    {#    var url = form.attr('action');#}
    {#    $.ajax({#}
    {#        type: "POST",#}
    {#        url: url,#}
    {#        data: form.serialize(), // serializes the form's elements.#}
    {#        success: function (data) {#}
    {#            alert(data); // show response from the php script.#}
    {#        }#}
    {#    });#}

    {#$("#idForm").submit(function (e) {#}
    {#    e.preventDefault(); // avoid to execute the actual submit of the form.#}
    {#    var form = $(this);#}
    {#    var url = form.attr('action');#}
    {#    $.ajax({#}
    {#        type: "POST",#}
    {#        url: url,#}
    {#        data: form.serialize(), // serializes the form's elements.#}
    {#        success: function (data) {#}
    {#            alert(data); // show response from the php script.#}
    {#        }#}
    {#    });#}


</script>
{##}
{##}
{#1. Error handling while submitting orders#}
{#2. URL FOR *******#}
{#3. fade out order messages#}
{#4. the last item#}
{#5. UTC DATE cookie#}
{#6. set token for receipt#}
{#7. md5 for cashier pw#}
{#8. error messages#}