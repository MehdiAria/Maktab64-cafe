<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
<script src="https://malsup.github.io/jquery.form.js"></script>

<div class="container-fluid">
    <div class="row">
        {% for category in data %}
            {% if data[category] is mapping %}
                <h1 class="bg-secondary p-4">{{ category }}</h1>
                {% for child_category in data[category] %}
                    <h1 class="bg-info p-3">{{ child_category }}</h1>
                    {% for item in data[category][child_category] %}
                        <div class="card bg-light col-{{ 12//(data | length) }} m-3">
                            <div class="card-body">
                                <img src="{{ item.image_url }}" alt="tea" class="w-100 card-img-top"
                                     style="line-height: 5vh">
                                <h3 class="card-text fw-light mt-3">{{ item.name }}</h3>
                                <button type="button" class="btn btn-secondary mt-4 w-100" data-bs-toggle="modal"
                                        data-bs-target="#myModal" onclick="func(this.id)" id="{{ item.name }}">
                                    {#                                <button class="btn btn-secondary mt-4 w-100" data-toggle="modal" data-target="#modal">#}
                                    Add To Cart
                                </button>
                            </div>
                        </div>
                    {% endfor %}
                {% endfor %}
            {% else %}
                <h1 class="bg-secondary p-4">{{ category }}</h1>
                {% for item in data[category] %}
                    <div class="card bg-light col-{{ 12//(data | length) }} m-3">
                        <div class="card-body">
                            <img src="{{ item.image_url }}" alt="tea" class="w-100 card-img-top"
                                 style="line-height: 5vh">
                            <h3 class="card-text fw-light mt-3">{{ item.name }}</h3>
                            <button class="btn btn-secondary mt-4 w-100">Add To Cart</button>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endfor %}
    </div>
</div>


<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Adding items to cart</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <form action="http://127.0.0.1:5000/order/1" method="POST" id="idForm">
                    <div class="dropdown">
                        <button type="button" class="btn btn-warning dropdown-toggle" data-bs-toggle="dropdown">
                            Select Your Table
                        </button>
                        <ul class="dropdown-menu">
                            {% for i in tables %}
                                <li><a class="dropdown-item" href="#" onclick="tableIdSet(this.id)"
                                       id={{ i.id }}>Table {{ i.id }} Space: {{ i.space }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                    <lable>Count:</lable>
                    <input type="number" class="form-control">
                    <span class="badge badge-primary">Item</span><input style="border: 0;background: white"
                                                                        class="form-control w-75" type="text"
                                                                        name="item_type"
                                                                        id="item_type" disabled>


                    <span class="badge badge-primary">Table</span><input style="border: 0;background: white"
                                                                         class="form-control w-75" type="text"
                                                                         name="table_id"
                                                                         id="table_id" disabled>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-success" onclick="order()">Add To Cart</button>
                    </div>
                </form>
                <div id="msg">

                </div>
            </div>


        </div>
    </div>
</div>


<script>
    function func(ItemValue) {
        let elem = $(`#${ItemValue}`).attr('id')
        $(`#item_type`).val(elem)
    }

    function tableIdSet(TableIdValue) {
        let elem = $(`#${TableIdValue}`).attr('id')
        $(`#table_id`).val(elem)
    }

    {##}
    {#$("#idForm").ajaxForm({#}
    {#    url: 'http://127.0.0.1:5000/order/1', type: 'post', success: function (data, response) {#}
    {#        alert(data); // show response from the php script.#}
    {#        alert(response); // show response from the php script.#}
    {#    }#}


    function order() {
        let elem = $(`#count`)
        let count = elem.val()
        let tbl = $(`#table_id`)
        let t_id = tbl.val()
        $.ajax({
            type: "POST",
            url: 'http://127.0.0.1:5000/order/1',
            data: {
                'count': count,
                'table': t_id,
            },
            success: function (response) {
                let parrent = $("#msg")
                let msg = $(` <div class="alert alert-success alert-dismissible fade show">
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        <strong>Success!</strong> ${response}
                    </div>`)
                msg.appendTo(parrent)
                {#alert(response); // show response from the php script.#}
                {#alert(data); // show response from the php script.#}
            }
        })
    }

    {##}
    {#$("#idForm").ajaxForm({url: 'http://127.0.0.1:5000/order/1', type: 'post', success: function (data,response) {#}
    {#            alert(data); // show response from the php script.#}
    {#            alert(response); // show response from the php script.#}
    {#        }})#}


    {#function order(){#}
    {#    let form = $('#idForm')#}
    {#    $.ajax({#}
    {#        type: "POST",#}
    {#        url:form.attr("action"),#}
    {#        data:form.serialize(),#}
    {#        success: function (data,response) {#}
    {#            alert(data); // show response from the php script.#}
    {#            alert(response); // show response from the php script.#}
    {#        }#}
    {#    })#}


    {#$("#idForm").submit(function (e) {#}
    {#    e.preventDefault(); // avoid to execute the actual submit of the form.#}
    {#    var form = $(this);#}
    {#    var url = form.attr('action');#}
    {#    $.ajax({#}
    {#        type: "POST",#}
    {#        url: url,#}
    {#        data: form.serialize(), // serializes the form's elements.#}
    {#        success: function (data) {#}
    {#            alert(data); // show response from the php script.#}
    {#        }#}
    {#    });#}


</script>